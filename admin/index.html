<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Админ-панель: Управление заявками</title>
    <!-- Подключаем Tailwind CSS для стилизации -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        /* Общие стили для меток статуса */
        .status-tag {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 0.875rem; 
            font-weight: 600;
            text-transform: uppercase;
            white-space: nowrap;
        }
        /* Цвета для статусов заявок */
        .status-pending { background-color: #FBBF24; color: #422006; } /* amber */
        .status-in_progress { background-color: #3B82F6; color: #EFF6FF; } /* blue */
        .status-ready_to_receive { background-color: #10B981; color: #ECFDF5; } /* green */
        .status-client_ready { background-color: #9333ea; color: #ffffff; } /* purple (клиент подтвердил) */
        .status-completed { background-color: #4B5563; color: #E5E7EB; } /* gray */
        
        /* Эффект при наведении на карточку */
        .request-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .request-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }
        
        /* Цветовые акценты для карточек */
        .card-pending { border-left: 5px solid #FBBF24; }
        .card-in_progress { border-left: 5px solid #3B82F6; }
        .card-ready_to_receive { border-left: 5px solid #10B981; }
        .card-client_ready { border-left: 5px solid #9333ea; }
        
        /* Стили для кастомного модального окна */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            max-width: 90%;
            min-width: 300px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8">

    <div class="max-w-4xl mx-auto">
        
        <!-- Заголовок -->
        <header class="text-center mb-8">
            <h1 class="text-3xl font-extrabold text-indigo-700">Админ-панель: Очередь CPM</h1>
            <p class="text-gray-500 font-medium mt-2">Управление заявками и статусом сервера</p>
            <p class="text-sm text-gray-400 mt-1">
                <a href="../index.html" class="text-indigo-500 hover:text-indigo-700 hover:underline">← Назад к Клиентской странице</a>
            </p>
        </header>
        
        <!-- Блок логина -->
        <div id="login-container" class="max-w-sm mx-auto bg-white p-8 rounded-lg shadow-xl mb-8 border-t-4 border-red-500">
            <h2 class="text-2xl font-bold mb-6 text-center text-red-600">Вход для Администратора</h2>
            
            <p id="auth-error-message" class="text-red-500 text-sm mb-4 hidden font-medium"></p>
            
            <div class="mb-4">
                <label for="admin-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                <input type="email" id="admin-email" placeholder="admin@example.com"
                       class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
            </div>
            <div class="mb-6">
                <label for="admin-password" class="block text-sm font-medium text-gray-700 mb-1">Пароль</label>
                <input type="password" id="admin-password" placeholder="********"
                       class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
            </div>
            
            <button id="login-btn" class="w-full py-2 px-4 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-150 disabled:opacity-50">
                Войти
            </button>
            
            <p class="text-xs text-gray-500 mt-4 text-center">
                Только авторизованные пользователи могут управлять очередью.
            </p>
        </div>
        
        <!-- Индикатор загрузки -->
        <div id="loading-indicator" class="text-center p-10 hidden">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"></div>
            <p class="mt-4 text-indigo-600 font-medium">Проверка данных...</p>
        </div>

        <!-- Основной контент (скрыт до успешной авторизации) -->
        <div id="main-app-content" class="hidden">
            
            <!-- Управление статусом сервера -->
            <div class="bg-white p-6 rounded-lg shadow-xl mb-8 border-t-4 border-indigo-500">
                <h2 class="text-xl font-bold mb-4 text-indigo-700">Статус Сервера</h2>
                
                <div class="flex items-center space-x-4 mb-4">
                    <span id="server-status-display" class="font-bold text-lg text-gray-700">
                        Статус: Загрузка...
                    </span>
                    <button id="toggle-online-btn" class="py-2 px-4 bg-green-500 text-white font-semibold rounded-lg shadow-md hover:bg-green-600 transition duration-150 disabled:opacity-50">
                        Перевести в ОНЛАЙН
                    </button>
                </div>
                
                <label for="server-message-input" class="block text-sm font-medium text-gray-700 mb-1">
                    Сообщение статуса (для клиентов):
                </label>
                <div class="flex space-x-3">
                    <input type="text" id="server-message-input" placeholder="Введите сообщение (например, 'Идет работа с 4 очередью')"
                           class="flex-grow px-4 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                    <button id="update-message-btn" class="py-2 px-4 bg-indigo-500 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-600 transition duration-150 disabled:opacity-50">
                        Обновить
                    </button>
                </div>
            </div>
            
            <h2 class="text-2xl font-bold text-indigo-700 mb-4">Текущая Очередь Заявок (<span id="queue-count">0</span>)</h2>
            
            <div id="requests-list" class="space-y-4">
                <!-- Карточки заявок будут вставлены здесь -->
            </div>
            
            <p id="empty-queue-message" class="p-6 bg-gray-200 text-gray-600 rounded-lg text-center mt-6 hidden">
                ✅ Очередь пуста! Все заявки обработаны.
            </p>
            
            <button id="logout-btn" class="mt-8 w-full py-2 px-4 bg-gray-500 text-white font-semibold rounded-lg hover:bg-gray-600 transition duration-150">
                Выйти из системы
            </button>
        </div>

    </div>

    <!-- Контейнер для кастомного модального окна -->
    <div id="custom-modal-container"></div>

    <!-- Модуль Firebase -->
    <script type="module">
        // Импортируем необходимые функции Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword, // Новая функция для входа по email/паролю
            signOut, // Новая функция для выхода
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            setDoc, 
            onSnapshot, 
            collection, 
            query, 
            updateDoc,
            deleteDoc,
            setLogLevel 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Глобальные переменные ---
        let db;
        let auth;
        let userId = null; 
        const QUEUE_COLLECTION = 'requests_queue';
        const STATUS_DOC = 'admin_online';
        
        // --- !!! ВАЖНО: ВАШИ КЛЮЧИ FIREBASE !!! ---
        const firebaseConfig = {
            apiKey: "AIzaSyBw_8Dx9gUI5tsUXSqX4Jd8hfjU4pNZGI8",
                    authDomain: "cpm-giveaway.firebaseapp.com",
                    projectId: "cpm-giveaway", 
        };
        const appId = firebaseConfig.projectId; // Используем projectId как appId
        const publicDataPath = `artifacts/${appId}/public/data`;

        // --- !!! ВАЖНО: UID АДМИНИСТРАТОРА !!! ---
        // 1. Создайте пользователя в Firebase Authentication
        // 2. Скопируйте его UID
        // 3. Вставьте его сюда.
        const ADMIN_UID = "3O4TAW5vf3hM9gZCVpzMAKqzDS52"; 
        // -----------------------------------------------------------------

        // DOM элементы
        const requestsListEl = document.getElementById('requests-list');
        const emptyQueueMessageEl = document.getElementById('empty-queue-message');
        const queueCountEl = document.getElementById('queue-count');
        const serverStatusDisplayEl = document.getElementById('server-status-display');
        const toggleOnlineBtn = document.getElementById('toggle-online-btn');
        const serverMessageInput = document.getElementById('server-message-input');
        const updateMessageBtn = document.getElementById('update-message-btn');
        const loadingIndicator = document.getElementById('loading-indicator');
        const mainAppContent = document.getElementById('main-app-content');
        const loginContainer = document.getElementById('login-container');
        const adminEmailInput = document.getElementById('admin-email');
        const adminPasswordInput = document.getElementById('admin-password');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const authErrorMessage = document.getElementById('auth-error-message');
        
        // Карта статусов для отображения
        const STATUS_MAP = {
            pending: "В ОЖИДАНИИ",
            in_progress: "В РАБОТЕ",
            ready_to_receive: "ГОТОВО К ПОЛУЧЕНИЮ", 
            client_ready: "КЛИЕНТ В ИГРЕ", 
            completed: "ЗАВЕРШЕНО"
        };
        // Классы стилей
        const STATUS_CLASSES = {
            pending: "status-pending",
            in_progress: "status-in_progress",
            ready_to_receive: "status-ready_to_receive",
            client_ready: "status-client_ready",
            completed: "status-completed"
        };
        const CARD_CLASSES = {
            pending: "card-pending",
            in_progress: "card-in_progress",
            ready_to_receive: "card-ready_to_receive",
            client_ready: "card-client_ready",
        };

        // --- Кастомный модальный диалог вместо alert/confirm ---
        function showCustomMessage(message) {
            const container = document.getElementById('custom-modal-container');
            container.innerHTML = `
                <div class="modal-overlay">
                    <div class="modal-content">
                        <p class="text-gray-800 mb-4">${message}</p>
                        <div class="flex justify-end">
                            <button id="modal-ok" class="px-4 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition duration-150">
                                ОК
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            const modalOk = document.getElementById('modal-ok');
            modalOk.onclick = () => {
                container.innerHTML = ''; // Закрыть модальное окно
            };
        }
        
        // --- 1. Инициализация Firebase и Проверка Аутентификации ---
        async function initializeFirebase() {
            setLogLevel('Debug');
            loadingIndicator.classList.remove('hidden');

            // Проверка, что ключи Firebase заполнены
            if (firebaseConfig.apiKey.includes('**ВСТАВЬТЕ')) {
                 loadingIndicator.innerHTML = `<p class="mt-4 text-red-600 font-bold">КРИТИЧЕСКАЯ ОШИБКА: Заполните ключи Firebase Config.</p>`;
                 return;
            }
            if (ADMIN_UID === "ВАШ_UID_АДМИНА_ИЗ_FIREBASE_КОНСОЛИ") {
                 loadingIndicator.innerHTML = `<p class="mt-4 text-red-600 font-bold">КРИТИЧЕСКАЯ ОШИБКА: Заполните ADMIN_UID в коде.</p>`;
                 return;
            }
            
            try {
                // Инициализация Firebase
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // Прослушиваем изменение состояния аутентификации
                onAuthStateChanged(auth, (user) => {
                    loadingIndicator.classList.add('hidden');
                    
                    if (user && user.uid === ADMIN_UID) {
                        // Успешная авторизация администратора
                        userId = user.uid;
                        showAdminPanel();
                    } else {
                        // Пользователь не авторизован или не является админом
                        userId = null;
                        showLoginForm();
                        if (user) {
                            // Если вошел, но UID не совпадает с админским, выходим
                            signOut(auth); 
                            authErrorMessage.textContent = "У вас нет прав администратора.";
                            authErrorMessage.classList.remove('hidden');
                        }
                    }
                });

            } catch (error) {
                console.error("Критическая ошибка инициализации Firebase:", error);
                loadingIndicator.innerHTML = `<p class="mt-4 text-red-600 font-bold">КРИТИЧЕСКАЯ ОШИБКА: ${error.message}. Проверьте ключи Firebase и правила безопасности!</p>`;
            }
        }
        
        // --- 2. Логика отображения ---
        function showAdminPanel() {
            loginContainer.classList.add('hidden');
            mainAppContent.classList.remove('hidden');
            authErrorMessage.classList.add('hidden');
            loadServerStatusAndRequests();
        }

        function showLoginForm() {
            loginContainer.classList.remove('hidden');
            mainAppContent.classList.add('hidden');
        }

        // --- 3. Функции входа и выхода ---
        loginBtn.addEventListener('click', async () => {
            const email = adminEmailInput.value.trim();
            const password = adminPasswordInput.value.trim();
            
            if (!email || !password) {
                authErrorMessage.textContent = "Введите Email и Пароль.";
                authErrorMessage.classList.remove('hidden');
                return;
            }
            
            loginBtn.disabled = true;
            authErrorMessage.classList.add('hidden');
            
            try {
                // Вход через Email и Пароль
                await signInWithEmailAndPassword(auth, email, password);
                // onAuthStateChanged обработает успешный вход и проверку ADMIN_UID
            } catch (error) {
                console.error("Ошибка входа:", error);
                authErrorMessage.textContent = "Ошибка входа. Проверьте Email/Пароль.";
                authErrorMessage.classList.remove('hidden');
                loginBtn.disabled = false;
            }
        });
        
        logoutBtn.addEventListener('click', async () => {
            try {
                await signOut(auth);
                showCustomMessage("Вы успешно вышли из системы.");
            } catch (error) {
                console.error("Ошибка выхода:", error);
                showCustomMessage(`Ошибка выхода: ${error.message}`);
            }
        });


        // --- 4. Запуск подписок на статус и очередь (только после входа) ---
        function loadServerStatusAndRequests() {
            // Загрузка глобального статуса сервера
            const statusDocRef = doc(db, `${publicDataPath}/app_status`, STATUS_DOC);
            onSnapshot(statusDocRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    updateServerStatusDisplay(data.isOnline, data.message);
                } else {
                    // Создаем документ статуса, если он не существует (по умолчанию оффлайн)
                    setDoc(statusDocRef, { isOnline: false, message: "Раздача приостановлена" }, { merge: true });
                    updateServerStatusDisplay(false, "Раздача приостановлена");
                }
            }, (error) => {
                console.error("Ошибка прослушивания статуса сервера:", error);
            });
            
            // Загрузка очереди заявок
            const queueCollectionRef = collection(db, `${publicDataPath}/${QUEUE_COLLECTION}`);
            onSnapshot(queueCollectionRef, (querySnapshot) => {
                const requests = [];
                querySnapshot.forEach(doc => {
                    requests.push({ id: doc.id, ...doc.data() });
                });
                
                // Сортировка по дате создания (createdAt)
                requests.sort((a, b) => {
                    const aTime = a.createdAt?.toDate ? a.createdAt.toDate().getTime() : 0;
                    const bTime = b.createdAt?.toDate ? b.createdAt.toDate().getTime() : 0;
                    return aTime - bTime;
                });
                
                renderRequests(requests);
            }, (error) => {
                console.error("Ошибка прослушивания очереди:", error);
            });
        }

        // --- 5. Обновление отображения статуса сервера ---
        function updateServerStatusDisplay(isOnline, message) {
            const statusText = isOnline ? "ОНЛАЙН" : "ОФФЛАЙН";
            const messageText = message || (isOnline ? "Раздача активна" : "Раздача приостановлена");
            
            serverStatusDisplayEl.innerHTML = `<span class="font-bold text-${isOnline ? 'green' : 'red'}-600">${statusText}</span>: ${messageText}`;
            toggleOnlineBtn.textContent = isOnline ? "Перевести в ОФФЛАЙН" : "Перевести в ОНЛАЙН";
            toggleOnlineBtn.classList.toggle('bg-red-500', isOnline);
            toggleOnlineBtn.classList.toggle('hover:bg-red-600', isOnline);
            toggleOnlineBtn.classList.toggle('bg-green-500', !isOnline);
            toggleOnlineBtn.classList.toggle('hover:bg-green-600', !isOnline);
            
            serverMessageInput.value = messageText;
        }

        // --- 6. Отображение списка заявок ---
        function renderRequests(requests) {
            queueCountEl.textContent = requests.length;
            requestsListEl.innerHTML = '';
            
            if (requests.length === 0) {
                emptyQueueMessageEl.classList.remove('hidden');
            } else {
                emptyQueueMessageEl.classList.add('hidden');
                requests.forEach(request => {
                    requestsListEl.appendChild(renderRequestCard(request));
                });
            }
        }
        
        // --- 7. Генерация карточки заявки ---
        function renderRequestCard(data) {
            const card = document.createElement('div');
            const statusClass = CARD_CLASSES[data.status] || 'card-pending';
            const statusTagClass = STATUS_CLASSES[data.status] || 'status-pending';
            const statusText = STATUS_MAP[data.status] || 'НЕИЗВЕСТНО';
            
            const createdAt = data.createdAt?.toDate ? data.createdAt.toDate().toLocaleString('ru-RU') : 'Неизвестно';
            const clientReadyAt = data.clientReadyAt?.toDate ? `<p class="text-sm font-semibold text-purple-700 mt-2">Клиент готов с: ${data.clientReadyAt.toDate().toLocaleTimeString('ru-RU')}</p>` : '';

            card.className = `request-card bg-white p-6 rounded-lg shadow-md mb-4 flex flex-col md:flex-row justify-between ${statusClass}`;
            
            // Основная информация
            card.innerHTML = `
                <div class="flex-grow">
                    <div class="flex items-center space-x-3 mb-3">
                        <span class="status-tag ${statusTagClass}">${statusText}</span>
                        <p class="text-xs text-gray-500">Заявка от: ${createdAt}</p>
                    </div>
                    
                    ${data.status === 'client_ready' ? `<div class="p-2 bg-purple-100 border border-purple-500 rounded mb-3 font-bold text-purple-800">❗ ОЖИДАЕТСЯ: КЛИЕНТ В ИГРЕ!</div>` : ''}

                    <p class="text-gray-800 font-bold mb-1">ID Подписчика (для связи):</p>
                    <p class="font-mono text-sm bg-gray-100 p-1 rounded mb-3 max-w-full overflow-auto break-words">${data.subscriberId || 'N/A'}</p>
                    
                    <p class="text-gray-800 font-bold mb-1">Детали Запроса:</p>
                    <p class="text-lg text-gray-900 mb-4 break-words">${data.requestDetails}</p>
                    
                    ${clientReadyAt}
                </div>
                
                <!-- Кнопки действий -->
                <div class="md:ml-6 mt-4 md:mt-0 flex flex-col space-y-2 w-full md:w-48 flex-shrink-0">
                    <button data-id="${data.id}" data-status="in_progress" class="change-status-btn py-2 px-4 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 transition">В РАБОТЕ</button>
                    <button data-id="${data.id}" data-status="ready_to_receive" class="change-status-btn py-2 px-4 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition">ГОТОВО</button>
                    <button data-id="${data.id}" data-status="completed" class="change-status-btn py-2 px-4 bg-gray-500 text-white font-semibold rounded-lg hover:bg-gray-600 transition">ЗАВЕРШЕНО</button>
                    <button data-id="${data.id}" class="delete-request-btn py-2 px-4 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition">УДАЛИТЬ</button>
                </div>
            `;
            
            return card;
        }

        // --- 8. Обработчик изменения статуса/удаления ---
        async function updateRequestStatus(docId, newStatus) {
            const docRef = doc(db, `${publicDataPath}/${QUEUE_COLLECTION}`, docId);
            try {
                // Если статус переходит в "Завершено" - удаляем документ
                if (newStatus === 'completed') {
                    await deleteDoc(docRef);
                    showCustomMessage(`Заявка ${docId.substring(0, 8)}... ЗАВЕРШЕНА и удалена из очереди.`);
                } else {
                    // В остальных случаях обновляем статус
                    await updateDoc(docRef, { 
                        status: newStatus,
                        lastUpdated: new Date()
                    });
                    showCustomMessage(`Статус заявки ${docId.substring(0, 8)}... изменен на ${STATUS_MAP[newStatus]}.`);
                }
            } catch (error) {
                console.error("Ошибка обновления статуса/удаления:", error);
                showCustomMessage(`Ошибка при изменении статуса: ${error.message}`);
            }
        }
        
        // --- 9. Обработчики кнопок ---
        
        // Обработчик нажатий на список заявок
        requestsListEl.addEventListener('click', async (e) => {
            const target = e.target;
            const docId = target.dataset.id;
            
            if (target.classList.contains('change-status-btn')) {
                const newStatus = target.dataset.status;
                if (docId) {
                    await updateRequestStatus(docId, newStatus);
                }
            } else if (target.classList.contains('delete-request-btn')) {
                if (docId) {
                    const isConfirmed = await window.confirm(`Вы уверены, что хотите НАВСЕГДА удалить заявку ${docId.substring(0, 8)}...?`);
                    if (isConfirmed) {
                        await updateRequestStatus(docId, 'completed'); // Используем удаление через 'completed'
                    }
                }
            }
        });

        // Обработчик переключения ОНЛАЙН/ОФФЛАЙН
        toggleOnlineBtn.addEventListener('click', async () => {
            const docRef = doc(db, `${publicDataPath}/app_status`, STATUS_DOC);
            toggleOnlineBtn.disabled = true;
            try {
                // Определяем текущий статус по тексту кнопки
                const currentStatus = toggleOnlineBtn.textContent.includes("ОФФЛАЙН"); 
                await setDoc(docRef, { isOnline: currentStatus }, { merge: true });
            } catch (error) {
                console.error("Ошибка переключения статуса:", error);
                showCustomMessage(`Ошибка переключения статуса: ${error.message}`);
            } finally {
                toggleOnlineBtn.disabled = false;
            }
        });
        
        // Обработчик обновления сообщения
        updateMessageBtn.addEventListener('click', async () => {
            const message = serverMessageInput.value.trim();
            if (message.length < 5) {
                showCustomMessage("Сообщение должно быть длиннее 5 символов.");
                return;
            }
            const docRef = doc(db, `${publicDataPath}/app_status`, STATUS_DOC);
            updateMessageBtn.disabled = true;
            try {
                await updateDoc(docRef, { message: message });
                showCustomMessage("Сообщение статуса обновлено.");
            } catch (error) {
                console.error("Ошибка обновления сообщения:", error);
                showCustomMessage(`Ошибка обновления сообщения: ${error.message}`);
            } finally {
                updateMessageBtn.disabled = false;
            }
        });
        
        // --- 10. Замена alert/confirm ---
        window.alert = showCustomMessage;
        window.confirm = (message) => {
            return new Promise(resolve => {
                const container = document.getElementById('custom-modal-container');
                container.innerHTML = `
                    <div class="modal-overlay">
                        <div class="modal-content">
                            <p class="text-gray-800 mb-4">${message}</p>
                            <div class="flex justify-end space-x-3">
                                <button id="modal-cancel" class="px-4 py-2 bg-gray-300 text-gray-800 font-medium rounded-lg hover:bg-gray-400 transition duration-150">Отмена</button>
                                <button id="modal-confirm" class="px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition duration-150">Подтвердить</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('modal-cancel').onclick = () => {
                    container.innerHTML = '';
                    resolve(false);
                };
                document.getElementById('modal-confirm').onclick = () => {
                    container.innerHTML = '';
                    resolve(true);
                };
            });
        };

        // --- Запуск ---
        initializeFirebase();

    </script>
</body>
</html>
